<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<script src="perlin.js"></script>
<script src="basefunctions.js"></script>
<script src="colorfunctions.js"></script>
<script>
function makeImage() {
  var options = JSON.parse(decodeURIComponent(document.URL.substr(document.URL.indexOf('options') + 8)));

  console.log(options);

  var newCanvas = document.createElement('canvas');
  newCanvas.height = options.height;
  newCanvas.width = options.width;
  newCanvas.style.display = 'none';
  document.body.appendChild(newCanvas);
  
  var context = newCanvas.getContext('2d');
  var imagedata = context.createImageData(options.width, options.height);
  
  baseFunction = PerlinTubulence.makeBaseFunction(options.baseFunction, options.baseFunctionOptions);
  colorFunction = PerlinTubulence.makeColorFunction(options.colorFunction, options.colorFunctionOptions);

  PerlinTubulence.makeImageSlice(imagedata.data, baseFunction, colorFunction, options.perlinOptions,
        options.width, options.height, options.scale, 0, options.height);

  context.putImageData(imagedata, 0, 0);
  var hurl = newCanvas.toDataURL();

  var newImage = document.createElement('img');
  newImage.height = options.height;
  newImage.width = options.width;
  newImage.src = hurl;
  document.body.appendChild(newImage);

  
}
</script>
</head>
  <body onload="makeImage()">
  </body>
</html>